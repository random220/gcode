#!/bin/bash

(ifconfig wls3|egrep '192.168.10.9[01]') >/dev/null 2>&1
if [[ $? == 0 ]]; then
  # we are on tiny or t2
  :
elif [[ $(ifconfig | grep -c 'inet 192.168.10.100') == 1 ]]; then
  # We are on my mac at home
  ssh -t om@192.168.10.90 vmount
  exit $?
else
  # we are probably outside home
  ssh -t om@www.crondite.com vmount
  exit $?
fi

vera_volume=/b/om/CRUZER.vol
if [[ ! -f $vera_volume ]]; then
  # nothing to do
  exit 0
fi

mountpoint=/b/m/p
if [[ ! -d $mountpoint ]]; then
  sudo mkdir -p $mountpoint
fi

mount | egrep "veracrypt.* $mountpoint" >/dev/null 2>&1
if [[ $? != 0 ]]; then 
  # Not already mounted. So, try to mount
  veracrypt --text --keyfiles='' --pim=0 --protect-hidden=no $vera_volume $mountpoint
fi

mount | egrep "veracrypt.* $mountpoint" >/dev/null 2>&1
exit $?


