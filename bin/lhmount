#!/bin/bash

target_machine='crondite.duckdns.org'
ifconfig -a|egrep 'inet .*192\.168\.10\.' >/dev/null 2>&1
if [[ $? == 0 ]]; then
  target_machine='192.168.10.180'
fi
ifconfig -a|egrep 'inet .*192\.168\.86\.' >/dev/null 2>&1
if [[ $? == 0 ]]; then
  target_machine='192.168.10.180'
fi


pubkey=~/.ssh/id_rsa.pub
if [[ -f $pubkey ]]; then
  cmd="scp $pubkey om@$target_machine:.ssh/authorized_keys"
  echo $cmd
  $cmd
fi

cmd="ssh -t om@$target_machine gcode/bin/vmount"
echo $cmd
$cmd

proot=~/b/om/p
mkdir -p $proot
umount $proot
sshfs om@$target_machine:/b/om/p $proot

open $proot
