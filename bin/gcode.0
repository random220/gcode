#!/bin/bash

if [[ ! -f ~/.profile ]]; then

    if [[ "$SHELL" == '/bin/ksh' ]]; then
        cat <<'EOF' >~/.profile
alias bb='export SHELL=/bin/bash; exec /bin/bash'
alias tt='tmux a'
EOF
    else
        cat <<'EOF'  >~/.profile
if [[ -f ~/.bashrc ]]; then
  . ~/.bashrc
fi
EOF
    fi
fi

if [[ ! -d ~/gcode ]]; then
    cd
    git clone https://github.com/random220/gcode
fi

if [[ ! -d ~/.gcode ]]; then
    mkdir ~/.gcode
    cd ~/.gcode
    ln -s ~/gcode/sundry/.bashrc
    ln -s ~/gcode/sundry/.aliases

    cd
    rm -f .vimrc .tmux.conf
    ln -s ~/gcode/sundry/.vimrc
    ln -s ~/gcode/sundry/.tmux.conf 
fi

cat <<'EOF' >>~/.bashrc
if [[ -f ~/.gcode/.bashrc ]]; then
    . ~/.gcode/.bashrc
fi
EOF

cd
rm -f .bash_profile
cat <<'EOF' >.bash_profile
    if [[ -f ~/.bashrc ]]; then
        . ~/.bashrc
    fi
EOF


umask 077

if [[ ! -d ~/.ssh ]]; then
    mkdir -p ~/.ssh
fi

if [[ ! -f ~/.ssh/config ]]; then
    u=$(uname)
    # MINGW64_NT-10.0-26334
    # CYGWIN_NT-10.0-26334
    # Darwin
    if [[ "$u" =~ ^MINGW64 ]] || [[ "$u" =~ ^CYGWIN ]] ; then
        cat <<EOF >~/.ssh/config
StrictHostKeyChecking=no
CheckHostIP=no
EscapeChar=~
UserKnownHostsFile=/dev/null
LogLevel ERROR

Host me
    Hostname localhost
    LocalForward 2222 localhost:22
    GatewayPorts yes

Host nuc
    User om
    HostName 192.168.10.180

Host cron
    User om
    HostName 76.236.30.161

Host nas2
    User om
    HostName 192.168.10.182

EOF
    else
        cp ~/gcode/sundry/.ssh/config ~/.ssh
    fi
fi
