#!/bin/bash

if [[ "$1" == '' ]]; then
  exit 0
fi

if [[ ! -f "$1" ]]; then
  exit 0
fi

( cd ~/.config/transmission && rm -rf blocklists resume torrents stats.json dht.dat )

pid=$$

cat <<EOF >~/bin/killme
#!/bin/bash
kill -SIGINT $pid
EOF

chmod 700 ~/bin/killme

mkdir -p ~/Downloads/uu
(
    cd ~/Downloads/uu
    # % df -kh .
    # Filesystem              Size  Used Avail Use% Mounted on
    # 192.168.10.182:/shares  2.0G  4.0K  2.0G   1% /home/om/x
    df -kh .|grep 192.168.10.182
    if [[ $? != 0 ]]; then
        cd ~/
        sshfs 192.168.10.182:/shares/data/movies/uu ~/Downloads/uu
    fi
)


exec transmission-cli -f ~/bin/killme -w ~/Downloads/uu "$1"
