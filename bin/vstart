#!/bin/bash
vmrun='/Applications/VMware Fusion.app/Contents/Library/vmrun'
vmx=/Users/omandal/b/VMs/ub24-luks.vmwarevm/ub24-luks.vmx
"$vmrun" start "$vmx"
ip=''
n=0
while true; do
    n=$(( n + 1 ))
    if [[ $n == 9 ]]; then
        echo 'Timed out'
        exit 1
    fi
    ip=$("$vmrun" getGuestIPAddress "$vmx")
    if [[ "$ip" =~ ^[0-9]+\.[0-9]+\.[0-9]+\.[0-9]+$ ]]; then
        break
    else
        sleep 5
    fi
done

out=$(
cat <<EOF
v=om@$ip
ssh \$v
EOF
)
echo "$out" | pbcopy
echo "$out"
