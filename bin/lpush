#!/bin/bash

bindir=$(dirname $0)

p=/b/om/p/CRUZER
if [[ ! -d $p ]]; then
    p=$HOME/b/om/p/CRUZER
fi
if [[ ! -d $p ]]; then
    echo "ERROR: Not found \"$p\""
    exit 1
fi

l=/b/om/l/CRUZER
if [[ ! -d $l ]]; then
    l=$HOME/b/om/l/CRUZER
fi
if [[ ! -d $l ]]; then
    echo "ERROR: Not found \"$l\""
    exit 1
fi

printf "Push to $l ? (y/n): "
read yesno
if [[ $yesno != 'y' ]]; then
  exit 1
fi

$bindir/vmount || exit 1
$bindir/lmount || exit 1

echo
echo "Syncing ..."
cmd="rsync -a --delete $p/ $l/"
echo "doing: $cmd"
$cmd

lastsync=$(date "+lastsync--%Y-%m-%d--%H-%M-%S")
(cd $l/.. && (rm -f lastsync*; touch $lastsync))
