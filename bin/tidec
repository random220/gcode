#!/bin/bash

set -x

tid0=~/b/om/p/CRUZER/gitted/sandbox/tiddly.html

cd ~/b/om || exit 1
rm -rf __xxx

if [[ -f "$tid0" ]]; then
    mkdir __xxx
    cp "$tid0" __xxx
else
    genc -t __xxx -d tiddly.html.git.tar.gpg
    if [[ ! -f '__xxx/tiddly.html.git.tar.gpg.plain' ]]; then
        exit 1
    fi
    (
    cd __xxx
    tar xf tiddly.html.git.tar.gpg.plain
    rm -f tiddly.html.git.tar.gpg.plain
    git reset --hard
    )
fi


(
rm -rf __chromecache_tidec
mkdir __chromecache_tidec
touch '__chromecache_tidec/First Run'
'/Applications/Google Chrome.app/Contents/MacOS/Google Chrome' --user-data-dir=./__chromecache_tidec __xxx/tiddly.html >/dev/null 2>&1
rm -rf __chromecache_tidec
) >/dev/null 2>&1 &

while true; do
    if [[ -d ~/b/om/__chromecache_tidec/Default/Sessions ]]; then
        break
    fi
    sleep 1
done

sleep 1
rm -rf __xxx
